# JVM关闭
JVM可以正常关闭，也可以强行关闭。正常关闭的方式有所有非守护线程的主动结束、
System.exit()方法的调用、Ctrl+C等方式。也可以通过Runtime.halt等方式强行
关闭JVM。

## 关闭回调
在正常关闭中，JVM会调用已经注册的回调函数。这些回调函数可以用于程序退出前的一些清理
工作。由于回调函数时并发执行的，因此编写这些回掉函数时，应该注意线程安全性
以及避免产生死锁代码。

## 守护线程
有时候，需要创建一个线程来执行一些辅助工作，但是又不想这个线程的运行阻碍JVM的关闭。
则可以使用守护线程（Daemon Thread）。

线程分为两种：守护线程和非守护线程。JVM启动时创建的线程中，除了Main线程，其余的全是
守护线程。创建新线程时，该线程将集成创建该线程的线程的状态。也就是默认情况下，创建的
线程默认都是非守护线程。

非守护线程和守护线程的区别在于：当一个线程退出时，JVM会检查其他正在运行的线程，如果
这些线程都是守护线程，则JVM会正常退出；当JVM退出时，所有的守护线程将会被抛弃，及
这些现场的finally块不会执行，JVM直接退出。

守护线程最好用于执行内部任务，比如周期性的清理过期数据。守护线程不应该用来代理
管理应用程序的各个生命周期。

## 终结器
当不在需要资源时，可以通过垃圾回收器自动回收。但是对于某些资源，如文件句柄等，使用
结束后必须显示地归还给系统。为了实现这个功能，垃圾回收器会对那些定义了finalize方法
的对象进行特殊处理，在垃圾回收的过程中调用finalize方法，从而保证一些持久化资源的
释放。

但是JVM不会保证finalize方法在什么时候执行，甚至不保证finalize方法会被调用。因此
应该避免使用finalize方法。要关闭资源在finally块中调用close方法才是比较合理的方式。

只有在某些资源是通过本地方法获得的是，可以使用finalize方法释放。但是正确的编写
finalize方法仍然是十分困难的。
